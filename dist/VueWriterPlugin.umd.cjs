(function(q,w){typeof exports=="object"&&typeof module<"u"?w(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],w):(q=typeof globalThis<"u"?globalThis:q||self,w(q.VueWriter={},q.Vue))})(this,function(q,w){"use strict";var it=(x,t,e)=>{if(!t.has(x))throw TypeError("Cannot "+e)},g=(x,t,e)=>(it(x,t,"read from private field"),e?e.call(x):t.get(x)),A=(x,t,e)=>{if(t.has(x))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(x):t.set(x,e)},v=(x,t,e,n)=>(it(x,t,"write to private field"),n?n.call(x,e):t.set(x,e),e),kt=(x,t,e)=>(it(x,t,"access private method"),e);const at="&lt;",P="&gt;",rt="/";var z,_,S,Q,K,U,X,F,Y,lt,ut;class Tt{constructor(t,e=!1){A(this,lt),A(this,z,[]),A(this,_,""),A(this,S,""),A(this,Q,[]),A(this,K,[]),A(this,U,[]),A(this,X,[]),A(this,F,[]),A(this,Y,[]),v(this,_,t.trim()),v(this,S,`${g(this,_)}
<Eof />`),this.protect(),e&&this.markupQuotes(),this.collectWords(g(this,S)),this.makeMistakes()}get list(){return g(this,z)}get text(){return g(this,_)}get workingText(){return g(this,S)}get words(){return g(this,Q)}get mistakes(){return g(this,F)}get mistakeCursors(){return g(this,Y)}get phraseStarts(){return g(this,K)}get phraseLengths(){return g(this,U)}get wordEnds(){return g(this,X)}translateBracket(t,e,n=!1){let i=t,s=!1;return"CDETQRG".includes(e)&&(e==="C"&&(i=n?")":"(",s=!0),e==="D"&&(i=n?"}}":"{{",s=!0),e==="E"&&(i=n?"}":"{",s=!0),e==="T"&&(i=n?"]":"[",s=!0),e==="Q"&&(i="'",s=!0),e==="R"&&(i='"',s=!0),e==="G"&&(i="`",s=!0)),{word:i,translated:s}}markupQuotes(){let t=g(this,S);const e=/(["'`])((\s|((\\)*)\\.|.)*?)\1/gm;let n;const i=[];for(;(n=e.exec(t))!==null;)n.index===e.lastIndex&&e.lastIndex++,i.push(n);for(let s=i.length-1;s>-1;s--){const r=i[s],a=r[1],u=r[0];let l=r[2];const d=r.index+1,h=d+u.length-1;let m="";a==='"'?m="R":a==="'"?m="Q":a==="`"&&(m="G"),l=l.replace(/&lt;/g,"&pp;"),l=l.replace(/&gt;/g,"&pg;");const y=`&oq;${m}&cq;${l}&oq;/${m}&cq;`,W=t.substring(0,d-1),p=t.substring(h);t=W+y+p}v(this,S,t)}doAttributes(t){const e={},n=/([\w]*)(\[\])?=("([\S ][^"]*)"|'([\S]*)'|\{\{ ([\w]*) \}\}|\{([\S ]*)\})/gm;let i;const s=[];for(;(i=n.exec(t))!==null;)i.index===n.lastIndex&&n.lastIndex++,s.push(i);for(let r=0;r<s.length;r++){const a=s[r],u=a[1],l=a[2],d=a[3].substring(0,1),h=a[4];l==="[]"?(e[u]===void 0&&(e[u]=[]),e[u].push(d+h)):e[u]=`${d}${h}`}return e}isClosedTag(t){let e=!1;const{text:n}=t;return n===""||(e=n.substring(n.length-5,n.length)===rt+P),e}isCloserTag(t){let e=!1;const{text:n}=t;return n===""||(e=n.substring(0,5)===at+rt),e}makeTag(t,e,n,i,s=!1){const{text:r}=t,{name:a}=t,u=this.list.length,l={};return l.id=t.id,l.name=a===""?"Fragment":a,l.text=r,l.startsAt=t.startsAt,l.endsAt=t.endsAt,s||(l.uid=kt(this,lt,ut),l.method="echo",l.props=l.name==="Fragment"?[]:[],l.depth=n,l.hasCloser=i,l.node=!1,l.isSingle=!1),(e[n]===void 0||e[n]===null)&&(e[n]=u-1),l.parentId=e[n],l}protect(){let t=g(this,S);t=t.trim(),t=t.replace(/\{\{/g,"<D>"),t=t.replace(/\}\}/g,"</D>"),t=t.replace(/\(/g,"<C>"),t=t.replace(/\)/g,"</C>"),t=t.replace(/\{/g,"<E>"),t=t.replace(/\}/g,"</E>"),t=t.replace(/\[/g,"<T>"),t=t.replace(/\]/g,"</T>"),t=t.replace(/<([/\w])/g,`${at}$1`),t=t.replace(/>/g,P),v(this,S,t)}collectTags(t,e="[\\w]+"){const n=[],i=[],s=`${at}\\/?(${e})((\\s|.*?)*?)\\/?${P}`,r=new RegExp(s,"gm");let a;for(;(a=r.exec(t))!==null;)a.index===r.lastIndex&&r.lastIndex++,i.push(a);let u=0;return i.forEach(l=>{const d=l;d.id=u,d.text=l[0],d.name=l[1]===null?"Fragment":l[1],d.startsAt=l.index,d.endsAt=l.index+d.text.length-1,delete d[0],delete d[1],delete d[2],delete d[3],n.push(d),u++}),n}collectWords(t){const e=[],n=[];let i=/([&oqpg;]{4})[\w /]+([&cqpp;]{4})/gm,s;for(;(s=i.exec(t))!==null;)s.index===i.lastIndex&&i.lastIndex++,n.push(s);let r=t;for(let a=n.length-1;a>-1;a--){const u=n[a][0],l=n[a].index+1,d=l+u.length-1,h="•".repeat(u.length),m=r.substring(0,l-1),y=r.substring(d);r=m+h+y}for(i=/([&lt;]{4})[\w /]+([&gt;]{4})/gm;(s=i.exec(r))!==null;)s.index===i.lastIndex&&i.lastIndex++,n.push(s);for(let a=n.length-1;a>-1;a--){const u=n[a][0],l=n[a].index+1,d=l+u.length-1,h="•".repeat(u.length),m=r.substring(0,l-1),y=r.substring(d);r=m+h+y}for(i=/([&ltgt;]{4})/gm;(s=i.exec(r))!==null;)s.index===i.lastIndex&&i.lastIndex++,n.push(s);for(let a=n.length-1;a>-1;a--){const u=n[a][0],l=n[a].index+1,d=l+u.length-1,h="•".repeat(u.length),m=r.substring(0,l-1),y=r.substring(d);r=m+h+y}for(i=/((?!•)\S[^•\n]*)/g;(s=i.exec(r))!==null;)s.index===i.lastIndex&&i.lastIndex++,g(this,K).push(s.index),g(this,U).push(s[0].length);for(i=/((?!•)\S[^•\n ]*)/g;(s=i.exec(r))!==null;){s.index===i.lastIndex&&i.lastIndex++;const a={};a.text=s[0],a.startsAt=s.index,a.endsAt=a.startsAt+s[0].length-1,e.push(a),g(this,X).push(a.endsAt)}v(this,Q,e)}makeMistakes(){let t=Math.ceil(Math.random()*2)-2;const e=Math.ceil(Math.random()*3)+2;g(this,Q).forEach(n=>{if(t++,t%e!==0||n.text.length<4)return;const i=Math.ceil(Math.random()*n.text.length)-1,s=String.fromCharCode(Math.ceil(Math.random()*26)+96);g(this,Y).push(n.startsAt+i),g(this,F).push(s)})}makeFaultyText(){let t=g(this,S);g(this,F).forEach(e=>{const n=t.substring(0,e.startsAt),i=t.substring(e.endsAt+1);t=n+e.text+i}),v(this,S,t)}splitTags(t){let e=[...t],n=e.length,i=0,s=!1,r=0;const a=n;let u=!1;const l=[],d=[];for(;e.length>0&&!s&&!u;){if(i===n){if(i=0,e=Object.values(e),n=e.length,n===0){s=!0;continue}r++,u=r>a+1}const h=e[i];if(e.length===1&&h.name==="Eof"){s=!0;continue}if(this.isClosedTag(h)&&h.name!=="Eof"){d[i]=e[i],delete e[i],i++;continue}if(i+1<n){const m=e[i+1];if(!this.isCloserTag(h)&&this.isCloserTag(m)){if(h.name!==m.name){l.push(h),delete e[i],i++;continue}d[i]=e[i],d[i+1]=e[i+1],delete e[i],delete e[i+1],i+=2;continue}}i++}return{regularTags:d,singleTags:l}}replaceTags(t,e){let n=t,i=e;const s=[];e.forEach(r=>{s[r.id]=r}),s.sort(),i=Object.values(s);for(let r=i.length-1;r>-1;r--){const a=i[r];a.text=a.text.substring(0,a.text.length-4)+rt+P;const u=n.substring(0,a.startsAt),l=n.substring(a.endsAt+1);n=u+a.text+l}return n}doComponents(t="[\\w]+"){let e=g(this,S);const n=this.collectTags(e,t),i=[];let s=[],r=0;const a=[];let u=n.length,l=0,d=!1,h=0;const m=u;let y=!1;a[r]=-1;const{singleTags:W}=this.splitTags(n);let p=n;for(W.length&&(W.forEach(E=>i.push(E.id)),e=this.replaceTags(e,W),p=this.collectTags(e,t));p.length>0&&!d&&!y;){if(l===u){if(l=0,p=Object.values(p),u=p.length,u===0){d=!0;continue}h++,y=h>m+1}const E=p[l];if(p.length===1&&E.name==="Eof"){d=!0;continue}if(this.isClosedTag(E)&&E.name!=="Eof"){const j=this.makeTag(E,a,r,!1);j.isSingle=i.includes(E.id),s[j.id]=j,delete p[l],l++;continue}if(this.isCloserTag(E)&&r--,l+1<u){const j=p[l+1];if(!this.isCloserTag(E)&&this.isCloserTag(j)){const B=this.makeTag(E,a,r,!0),M=this.makeTag(j,a,r,!1,!0);M.contents={},M.parentId=B.id,M.contents.startsAt=B.endsAt+1,M.contents.endsAt=M.startsAt;const ot=e.substring(M.contents.startsAt,M.contents.endsAt);M.contents.text=ot,B.closer=M,s[B.id]=B,delete p[l],delete p[l+1],l+=2;continue}!this.isCloserTag(E)&&!this.isCloserTag(j)&&(r++,a[r]=E.id)}l++}s=Object.values(s),v(this,S,e),v(this,z,s)}}z=new WeakMap,_=new WeakMap,S=new WeakMap,Q=new WeakMap,K=new WeakMap,U=new WeakMap,X=new WeakMap,F=new WeakMap,Y=new WeakMap,lt=new WeakSet,ut=function(){return Date.now()*Math.random()};const I="&lt;",$="&gt;",H="<",V=">",D="/",L=`
`;var Z,R,tt,G,J;class dt{constructor(t,e,n,i,s){A(this,Z,""),A(this,R,60),A(this,tt,!1),A(this,G,()=>{}),A(this,J,()=>{}),v(this,G,t),v(this,Z,e),v(this,R,n),v(this,J,s),v(this,tt,i)}async writeLikeAHuman(t,e){const n=e!==void 0,i=g(this,G).querySelector(`pre#${e} code`),s=g(this,G).querySelector(n?`pre#${t} code`:`div#${t}`);let r=g(this,R),a=[],u="",l="",d="",h=null,m=[];const y=[];let W="",p="",E=-1;const j=[],B=[];let M=0,ot=this;function pt(o){return new Promise(c=>{setTimeout(c,o)})}function Wt(o){return Math.floor(o*.75+Math.random()*o)}async function C(o,c=!1){let k=a.join("");c&&(k=k.trim()),r=Wt(g(ot,R)),u+=o,s.innerHTML=u+k,n&&window.hljs!==void 0&&window.hljs.highlightElement(s),await pt(r)}async function It(){const o=a.join("");u=u.substring(0,u.length-1),s.innerHTML=u+o,await pt(r)}function et(o){a.unshift(o)}function st(){delete a[0],a=Object.values(a)}function $t(o){const c=[],k=/^([^\S][ \s]+)*/gm;let O;for(;(O=k.exec(o))!==null;)O.index===k.lastIndex&&k.lastIndex++,c.push(O[0]??"");return c}function jt(o){const c=/^([^\S][ \s]+)*/gm;return o.replace(c,"")}function Ot(o){const c=o.split(`
`);return"<br />".repeat(c.length)}async function mt(o){let c="";return await fetch(o).then(k=>k.text()).then(k=>{c=k}),console.log({url:o,loadText:mt}),c}function qt(o){return o.replaceAll(I,H).replaceAll($,V)}function Ht(){let o=null;return m.length&&(o=m.shift(),o.hasCloser&&y.push(o)),o}function Lt(){return y.length?y[y.length-1]:null}function Bt(){if(!j.length)return null;const o=j.pop(),c=B.pop();et(c?L+l+o:o)}function wt(o){let c=null;if(!y.length||(c=Lt(),o===c.depth))return c;let k=!1;for(let O=y.length-1;O>-1;O--)if(c=y[O],o===c.depth){k=!0;break}return k?c:null}const Vt=g(this,Z);n&&window.hljs!==void 0&&window.hljs.highlightElement(i),W=await mt(Vt),console.log({text:W});const xt=$t(W);W=jt(W);const b=new Tt(W,n);b.doComponents(),m=[...b.list],p=b.workingText.replace(`${L+I}Eof ${D}${$}`,""),n&&(i.innerHTML=Ot(W+`
`));const Dt=xt[M]??"";await C(Dt),M++;for(let o=0;o<p.length;o++){let c=p[o];if(n&&c===H){c=I,await C(c);continue}if(g(this,tt)&&b.mistakes.length&&b.phraseStarts.length&&b.phraseStarts[0]===o){const T=b.phraseLengths[0];for(let f=0;f<T;f++){const N=o+f,ct=b.mistakeCursors[0];if(c=p[N],ct===N?await C(b.mistakes[0]):await C(c),b.wordEnds.includes(N)&&b.mistakeCursors.length){const nt=b.mistakeCursors[0];if(nt<=N){const ht=N-nt+1;for(let bt=0;bt<ht;bt++)await It(),f--;b.mistakes.shift(),b.mistakeCursors.shift()}}}b.phraseStarts.shift(),b.phraseLengths.shift(),o+=T-1;continue}const k=p.substring(o,o+4),O=p.substring(o,o+5);if(c==="&"&&O==="&oq;/"){const T=p.substring(o+5,o+6),{word:f}=b.translateBracket(c,T);st(),await C(f),o+=9;continue}if(c==="&"&&k==="&oq;"){const T=p.substring(o+4,o+5),{word:f}=b.translateBracket(c,T);et(f),await C(f),o+=8;continue}if(c==="&"&&k==="&pp;"){o+=3,await C(I);continue}if(c==="&"&&k==="&pg;"){o+=3,await C($);continue}if(n){if(c==="/"&&O===D+$&&h!==null&&!h.hasCloser&&h.endsAt===o+4){c=D+$,st(),await C(c),o+=4;continue}if(c==="&"&&k===$&&h!==null&&h.endsAt===o+3){st(),await C($),h.hasCloser&&Bt(),o+=3;continue}}if(c==="&"&&O===I+D){h=wt(E),h===null&&E-1>-1&&(h=wt(E-1)),c=h.closer.text,n||(c=H+D+h.closer.name+V);const{word:T}=b.translateBracket(c,h.name,!0);if(c=T,c!==""){st(),o=h.closer.endsAt,await C(c),E--,h=null;continue}}if(c==="&"&&k!==I){const T=p.substring(o).indexOf(";");if(T>8){await C(c);continue}const f=p.substring(o,o+T+1);await C(f),o+=f.length-1;continue}if(c==="&"&&k===I){if((h===null||h!==null&&h.dirty)&&(h=Ht()),h.startsAt!==o){n?(c=I,o+=3):(c=h.text.replace(I,H),c=c.replace($,V)),await C(c),h.dirty=!1;continue}h.dirty=!0;let T=!1,f="";c=h.text,n||(c=h.text.replace(I,H),c=c.replace($,V));const{word:N,translated:ct}=b.translateBracket(c,h.name);if(c=N,h.hasCloser){E++,f=h.closer.text,n||(f=H+D+h.closer.name+V);const{word:nt,translated:ht}=b.translateBracket(f,h.name,!0);f=nt,T=h.closer.contents.text.indexOf(L)>-1,ht?(o=h.endsAt,et(T?L+l+f:f)):(j.push(f),B.push(T))}ct||(T=h.text.indexOf(L)>-1,n?(c=I,o+=3,f=$):(c=h.text.replace(I,H),c=c.replace($,V),o+=h.text.length-1,f=H+D+h.closer.name+V),et(T?L+l+f:f)),await C(c);continue}if(c===L){l=xt[M]??"",d=L+l;const T=a.length?a[0].trim():"",f=p.substring(o+1,o+T.length+1);M++,await C(d,T===f);continue}await C(c)}u=qt(u),this.finishedEvent(u)}finishedEvent(t){typeof g(this,J)=="function"&&g(this,J).call(this,t)}}Z=new WeakMap,R=new WeakMap,tt=new WeakMap,G=new WeakMap,J=new WeakMap;const yt=w.createElementVNode("div",{class:"to-be-written"},[w.createElementVNode("div",{id:"to-write"})],-1),Et=[yt],Ct=w.defineComponent({name:"TextWriter"});var gt=Object.assign(Ct,{props:{source:{default:""},speed:{default:"60"},dependsOnSelector:{default:""},makeTypos:{default:!1},styles:{default:""},classes:{default:""},finished:{default:!1},restart:{default:!1}},setup(x){const t=x,e=w.ref(null);w.onMounted(async()=>{const s=e.value.ownerDocument;if(t.styles!==""&&t.classes!==""&&(t.styles.split(",").forEach(r=>{const a=s.createElement("style");a.innerHTML=`@import "${r}"`,s.head.appendChild(a)}),s.getElementById("to-write").setAttribute("class",t.classes)),t.dependsOnSelector!==""){const r=s.querySelector(t.dependsOnSelector);if(r!==null){const a={attributes:!0};new MutationObserver(async(u,l)=>{for(const d of u)d.type==="attributes"&&d.attributeName==="finished"&&r.getAttribute("finished")==="true"&&(l.disconnect(),await i())}).observe(r,a)}}else await i()});const n=function(s){const r=new CustomEvent("finishedWriting",{bubbles:!0,cancellable:!0,detail:{content:s}});e.value.dispatchEvent(r),e.value.setAttribute("finished","true")},i=async()=>{const s=e.value.ownerDocument;await new dt(s,t.source,t.speed,t.makeTypos,n).writeLikeAHuman("to-write")};return(s,r)=>(w.openBlock(),w.createElementBlock("div",{ref_key:"root",ref:e,class:"text-snippet"},Et,512))}});gt.__file="src/components/TextWriter.vue";const At=w.createElementVNode("div",{class:"to-be-copied"},[w.createElementVNode("pre",{id:"to-copy"},[w.createElementVNode("code")])],-1),Mt=w.createElementVNode("div",{class:"to-be-written"},[w.createElementVNode("pre",{id:"to-write"},[w.createElementVNode("code")])],-1),vt=[At,Mt],St=w.defineComponent({name:"CodeWriter"});var ft=Object.assign(St,{props:{source:{default:""},speed:{default:"60"},dependsOnSelector:{default:""},makeTypos:{default:!1},styles:{default:""},classes:{default:""},finished:{default:!1},restart:{default:!1},useHighlightJs:{default:!1},theme:{default:"base16/monokai"},language:{default:"html"}},setup(x){const t=x,e=w.ref(null);w.onMounted(async()=>{const s=e.value.ownerDocument;if(t.useHighlightJs){const r=t.theme??"base16/monokai",a=t.language??"html",u=s.createElement("script");u.src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js",s.head.appendChild(u);const l=[];l.push("https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css"),l.push(`https://highlightjs.org/static/demo/styles/${r}.css`),l.forEach(h=>{const m=s.createElement("style");m.innerHTML=`@import "${h}"`,s.head.appendChild(m)});const d=s.querySelectorAll("code");for(const h of d)h.setAttribute("class",`language-${a}`)}if(t.styles!==""&&t.classes!==""&&(t.styles.split(",").forEach(r=>{const a=s.createElement("style");a.innerHTML=`@import "${r}"`,s.head.appendChild(a)}),s.getElementById("to-write").setAttribute("class",t.classes)),t.dependsOnSelector!==""){const r=s.querySelector(t.dependsOnSelector);if(r!==null){const a={attributes:!0};new MutationObserver(async(u,l)=>{for(const d of u)d.type==="attributes"&&d.attributeName==="finished"&&r.getAttribute("finished")==="true"&&(l.disconnect(),await i())}).observe(r,a)}}else await i()});const n=function(s){const r=new CustomEvent("finishedWriting",{bubbles:!0,cancellable:!0,detail:{content:s}});e.value.dispatchEvent(r),e.value.setAttribute("finished","true")},i=async()=>{const s=e.value.ownerDocument;await new dt(s,t.source,t.speed,t.makeTypos,n).writeLikeAHuman("to-write","to-copy")};return(s,r)=>(w.openBlock(),w.createElementBlock("div",{ref_key:"root",ref:e,class:"code-snippet"},vt,512))}});ft.__file="src/components/CodeWriter.vue",q.CodeWriter=ft,q.TextWriter=gt,Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});
